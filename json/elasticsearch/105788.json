[{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> { throw new RuntimeException(\"processor failed\"); });\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(), not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","date":"2018-04-26 03:22:53","endLine":126,"groupId":"54659","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testExecuteVerboseItemExceptionWithoutOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a4/320d264110edeaefc04e0fd46f22d9dcebe46a.src","preCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> { throw new RuntimeException(\"processor failed\"); });\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(), not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":104,"status":"B"},{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> { throw new RuntimeException(\"processor failed\"); });\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","date":"2018-04-26 03:22:53","endLine":162,"groupId":"48901","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testExecuteVerboseItemWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a4/320d264110edeaefc04e0fd46f22d9dcebe46a.src","preCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> { throw new RuntimeException(\"processor failed\"); });\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":128,"status":"B"}],"commitId":"d74fb9eb4559077e2d20b19a9ed62d9ff825027a","commitMessage":"@@@Opened x-pack ILM code\n","date":"2018-04-26 03:22:53","modifiedFileCount":"0","status":"B","submitter":"Tal Levy"},{"authorTime":"2019-09-19 22:45:45","codes":[{"authorDate":"2019-09-19 22:45:45","commitOrder":2,"curCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(),\n                not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","date":"2019-09-19 22:45:45","endLine":125,"groupId":"54659","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testExecuteVerboseItemExceptionWithoutOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ac/928d9194f80d303afdc434a8a15694781ffc21.src","preCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\",\n                ingestDocument -> { throw new RuntimeException(\"processor failed\"); });\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(),\n                not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":102,"status":"M"},{"authorDate":"2019-09-19 22:45:45","commitOrder":2,"curCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),\n                ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","date":"2019-09-19 22:45:45","endLine":162,"groupId":"48901","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testExecuteVerboseItemWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ac/928d9194f80d303afdc434a8a15694781ffc21.src","preCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\",\n                ingestDocument -> { throw new RuntimeException(\"processor failed\"); });\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),\n                ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":127,"status":"M"}],"commitId":"08e3cebc00ec08c3e2fc9e4a4d2253b8ed16417a","commitMessage":"@@@Allow dropping documents with auto-generated ID (#46773)\n\nWhen using auto-generated IDs + the ingest drop processor (which looks to be used by filebeat\nas well) + coordinating nodes that do not have the ingest processor functionality.  this can lead\nto a NullPointerException.\n\nThe issue is that markCurrentItemAsDropped() is creating an UpdateResponse with no id when\nthe request contains auto-generated IDs. The response serialization is lenient for our\nREST/XContent format (i.e. we will send \"id\" : null) but the internal transport format (used for\ncommunication between nodes) assumes for this field to be non-null.  which means that it can't\nbe serialized between nodes. Bulk requests with ingest functionality are processed on the\ncoordinating node if the node has the ingest capability.  and only otherwise sent to a different\nnode. This means that.  in order to reproduce this.  one needs two nodes.  with the coordinating\nnode not having the ingest functionality.\n\nCloses #46678","date":"2019-09-19 22:45:45","modifiedFileCount":"17","status":"M","submitter":"Yannick Welsch"},{"authorTime":"2019-09-25 22:03:06","codes":[{"authorDate":"2019-09-25 22:03:06","commitOrder":3,"curCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(),\n                not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","date":"2019-09-25 22:03:06","endLine":149,"groupId":"54659","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testExecuteVerboseItemExceptionWithoutOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a9/496ec16fadadeb68362bda4ae37846a211b211.src","preCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(),\n                not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":119,"status":"M"},{"authorDate":"2019-09-25 22:03:06","commitOrder":3,"curCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),\n                ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","date":"2019-09-25 22:03:06","endLine":193,"groupId":"48901","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testExecuteVerboseItemWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a9/496ec16fadadeb68362bda4ae37846a211b211.src","preCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        SimulateDocumentResult actualItemResponse = executionService.executeDocument(pipeline, ingestDocument, true);\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),\n                ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":151,"status":"M"}],"commitId":"2c7fd822930b4ecb651d1903d99798e6f0c504b2","commitMessage":"@@@Allow ingest processors to execute in a non blocking manner. (#46241)\n\nThis PR changes the ingest executing to be non blocking\nby adding an additional method to the Processor interface\nthat accepts a BiConsumer as handler and changing\nIngestService#executeBulkRequest(...) to ingest document\nin a non blocking fashion iff a processor executes\nin a non blocking fashion.\n\nThis is the second PR that merges changes made to server module from\nthe enrich branch (see #32789) into the master branch.\n\nThe plan is to merge changes made to the server module separately from\nthe pr that will merge enrich into master.  so that these changes can\nbe reviewed in isolation.\n\nThis change originates from the enrich branch and was introduced there\nin #43361.","date":"2019-09-25 22:03:06","modifiedFileCount":"20","status":"M","submitter":"Martijn van Groningen"},{"authorTime":"2020-01-15 23:17:05","codes":[{"authorDate":"2020-01-15 23:17:05","commitOrder":4,"curCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(0), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","date":"2020-01-15 23:17:05","endLine":150,"groupId":"54659","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testExecuteVerboseItemExceptionWithoutOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/83/4aa57b2d825683ca663adbd9a42beea3917820.src","preCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument().getSourceAndMetadata(),\n                not(sameInstance(ingestDocument.getSourceAndMetadata())));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":123,"status":"M"},{"authorDate":"2020-01-15 23:17:05","commitOrder":4,"curCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(1), pipeline.getId(),\n            ingestDocumentWithOnFailureMetadata);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(2), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","date":"2020-01-15 23:17:05","endLine":192,"groupId":"48901","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testExecuteVerboseItemWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/83/4aa57b2d825683ca663adbd9a42beea3917820.src","preCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(),\n                ingestDocumentWithOnFailureMetadata);\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), not(sameInstance(ingestDocument)));\n        assertIngestDocument(simulateDocumentVerboseResult.getProcessorResults().get(2).getIngestDocument(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":152,"status":"M"}],"commitId":"2b2935fd52368928307ff2e8614e9d4e4b56e027","commitMessage":"@@@Add pipeline name to ingest metadata (#50467)\n\nThis commit adds the name of the current pipeline to ingest metadata.\nThis pipeline name is accessible under the following key: '_ingest.pipeline'.\n\nExample usage in pipeline:\nPUT /_ingest/pipeline/2\n{\n    \"processors\": [\n        {\n            \"set\": {\n                \"field\": \"pipeline_name\". \n                \"value\": \"{{_ingest.pipeline}}\"\n            }\n        }\n    ]\n}\n\nCloses #42106","date":"2020-01-15 23:17:05","modifiedFileCount":"6","status":"M","submitter":"Martijn van Groningen"},{"authorTime":"2020-06-16 05:08:29","codes":[{"authorDate":"2020-06-16 05:08:29","commitOrder":5,"curCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", null, ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", null, new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", null, ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(0), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","date":"2020-06-16 05:08:29","endLine":150,"groupId":"54659","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testExecuteVerboseItemExceptionWithoutOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/83/264ff1cb6b6a5949ce9221218c70f306776805.src","preCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(0), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":123,"status":"M"},{"authorDate":"2020-06-16 05:08:29","commitOrder":5,"curCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", null, new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", null, ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", null, ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(1), pipeline.getId(),\n            ingestDocumentWithOnFailureMetadata);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(2), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","date":"2020-06-16 05:08:29","endLine":192,"groupId":"48901","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testExecuteVerboseItemWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/83/264ff1cb6b6a5949ce9221218c70f306776805.src","preCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(1), pipeline.getId(),\n            ingestDocumentWithOnFailureMetadata);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(2), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":152,"status":"M"}],"commitId":"69a6a18d8dc3f95001cfe6f55c1451ac616f7e84","commitMessage":"@@@Add optional description parameter to ingest processors. (#57906)\n\nThis commit adds an optional field.  `description`.  to all ingest processors\nso that users can explain the purpose of the specific processor instance.\n\nCloses #56000.","date":"2020-06-16 05:08:29","modifiedFileCount":"125","status":"M","submitter":"Tal Levy"},{"authorTime":"2021-08-11 21:30:36","codes":[{"authorDate":"2021-08-11 21:30:36","commitOrder":6,"curCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", null, ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", null, new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", null, ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, null, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(0), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","date":"2021-08-11 21:30:36","endLine":139,"groupId":"105788","id":11,"instanceNumber":1,"isCurCommit":1,"methodName":"testExecuteVerboseItemExceptionWithoutOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/e4/9f21babe483104e8ee5d87ac6de0510b847e27.src","preCode":"    public void testExecuteVerboseItemExceptionWithoutOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", null, ingestDocument -> {});\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", null, new RuntimeException(\"processor failed\"));\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", null, ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, new CompoundProcessor(processor1, processor2, processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(processor3.getInvokedCounter(), equalTo(0));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(2));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), nullValue());\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(0), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":112,"status":"M"},{"authorDate":"2021-08-11 21:30:36","commitOrder":6,"curCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", null, new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", null, ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", null, ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version, null,\n            new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(1), pipeline.getId(),\n            ingestDocumentWithOnFailureMetadata);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(2), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","date":"2021-08-11 21:30:36","endLine":181,"groupId":"105788","id":12,"instanceNumber":2,"isCurCommit":1,"methodName":"testExecuteVerboseItemWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/e4/9f21babe483104e8ee5d87ac6de0510b847e27.src","preCode":"    public void testExecuteVerboseItemWithOnFailure() throws Exception {\n        TestProcessor processor1 = new TestProcessor(\"processor_0\", \"mock\", null, new RuntimeException(\"processor failed\"));\n        TestProcessor processor2 = new TestProcessor(\"processor_1\", \"mock\", null, ingestDocument -> {});\n        TestProcessor processor3 = new TestProcessor(\"processor_2\", \"mock\", null, ingestDocument -> {});\n        Pipeline pipeline = new Pipeline(\"_id\", \"_description\", version,\n                new CompoundProcessor(new CompoundProcessor(false, Collections.singletonList(processor1),\n                                Collections.singletonList(processor2)), processor3));\n        CountDownLatch latch = new CountDownLatch(1);\n        AtomicReference<SimulateDocumentResult> holder = new AtomicReference<>();\n        executionService.executeDocument(pipeline, ingestDocument, true, (r, e) -> {\n            holder.set(r);\n            latch.countDown();\n        });\n        latch.await();\n        SimulateDocumentResult actualItemResponse = holder.get();\n        assertThat(processor1.getInvokedCounter(), equalTo(1));\n        assertThat(processor2.getInvokedCounter(), equalTo(1));\n        assertThat(actualItemResponse, instanceOf(SimulateDocumentVerboseResult.class));\n        SimulateDocumentVerboseResult simulateDocumentVerboseResult = (SimulateDocumentVerboseResult) actualItemResponse;\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().size(), equalTo(3));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getProcessorTag(), equalTo(\"processor_0\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getIngestDocument(), nullValue());\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure(), instanceOf(RuntimeException.class));\n        RuntimeException runtimeException = (RuntimeException) simulateDocumentVerboseResult.getProcessorResults().get(0).getFailure();\n        assertThat(runtimeException.getMessage(), equalTo(\"processor failed\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getProcessorTag(), equalTo(\"processor_1\"));\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getIngestDocument(), not(sameInstance(ingestDocument)));\n\n        IngestDocument ingestDocumentWithOnFailureMetadata = new IngestDocument(ingestDocument);\n        Map<String, Object> metadata = ingestDocumentWithOnFailureMetadata.getIngestMetadata();\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TYPE_FIELD, \"mock\");\n        metadata.put(CompoundProcessor.ON_FAILURE_PROCESSOR_TAG_FIELD, \"processor_0\");\n        metadata.put(CompoundProcessor.ON_FAILURE_MESSAGE_FIELD, \"processor failed\");\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(1), pipeline.getId(),\n            ingestDocumentWithOnFailureMetadata);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(1).getFailure(), nullValue());\n\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getProcessorTag(), equalTo(\"processor_2\"));\n        assertVerboseResult(simulateDocumentVerboseResult.getProcessorResults().get(2), pipeline.getId(), ingestDocument);\n        assertThat(simulateDocumentVerboseResult.getProcessorResults().get(2).getFailure(), nullValue());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":141,"status":"M"}],"commitId":"498684a696fb2d81689a9c5e51fbc3c370e234f6","commitMessage":"@@@Add support for _meta field to ingest pipelines (#75905)\n\nWe are adding a _meta field to many of our REST APIs so that users can attach whatever metadata they\nwant. The data in this field will not be used by Elasticsearch. This commit add the _meta field to ingest\npipelines.","date":"2021-08-11 21:30:36","modifiedFileCount":"13","status":"M","submitter":"Keith Massey"}]
