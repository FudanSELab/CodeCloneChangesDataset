[{"authorTime":"2019-08-31 00:56:39","codes":[{"authorDate":"2019-08-31 00:56:39","commitOrder":1,"curCode":"  public void testDeleteRunningWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, LONG_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    \r\n    _driver.pollForJobState(workflowName, TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"),\n        TaskState.IN_PROGRESS);\n\n    \r\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n    Assert.assertNotNull(_admin.getResourceIdealState(CLUSTER_NAME, workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      IdealState is = _admin.getResourceIdealState(CLUSTER_NAME, workflowName);\n      return (wfcfg == null && wfctx == null && is == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","date":"2019-08-31 00:56:39","endLine":184,"groupId":"4275","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testDeleteRunningWorkflowForcefully","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/49/82f1c85553af1c9c8527e047bb32db3d7d881f.src","preCode":"  public void testDeleteRunningWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, LONG_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    \r\n    _driver.pollForJobState(workflowName, TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"),\n        TaskState.IN_PROGRESS);\n\n    \r\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n    Assert.assertNotNull(_admin.getResourceIdealState(CLUSTER_NAME, workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      IdealState is = _admin.getResourceIdealState(CLUSTER_NAME, workflowName);\n      return (wfcfg == null && wfctx == null && is == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/integration/task/TestForceDeleteWorkflow.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":144,"status":"B"},{"authorDate":"2019-08-31 00:56:39","commitOrder":1,"curCode":"  public void testDeleteStoppedWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, MEDIUM_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    _driver.stop(workflowName);\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.STOPPED);\n\n    \r\n    boolean areJobsStopped = TestHelper.verify(() -> {\n      WorkflowContext wCtx1 = _driver.getWorkflowContext(workflowName);\n      TaskState job0 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"));\n      TaskState job1 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB1\"));\n      TaskState job2 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB2\"));\n      return ((job0 == null || job0 == TaskState.STOPPED)\n          && (job1 == null || job1 == TaskState.STOPPED)\n          && (job2 == null || job2 == TaskState.STOPPED));\n    }, 60 * 1000);\n    Assert.assertTrue(areJobsStopped);\n\n    \r\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n    Assert.assertNotNull(_admin.getResourceIdealState(CLUSTER_NAME, workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      IdealState is = _admin.getResourceIdealState(CLUSTER_NAME, workflowName);\n      return (wfcfg == null && wfctx == null && is == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","date":"2019-08-31 00:56:39","endLine":240,"groupId":"4275","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testDeleteStoppedWorkflowForcefully","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/49/82f1c85553af1c9c8527e047bb32db3d7d881f.src","preCode":"  public void testDeleteStoppedWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, MEDIUM_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    _driver.stop(workflowName);\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.STOPPED);\n\n    \r\n    boolean areJobsStopped = TestHelper.verify(() -> {\n      WorkflowContext wCtx1 = _driver.getWorkflowContext(workflowName);\n      TaskState job0 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"));\n      TaskState job1 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB1\"));\n      TaskState job2 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB2\"));\n      return ((job0 == null || job0 == TaskState.STOPPED)\n          && (job1 == null || job1 == TaskState.STOPPED)\n          && (job2 == null || job2 == TaskState.STOPPED));\n    }, 60 * 1000);\n    Assert.assertTrue(areJobsStopped);\n\n    \r\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n    Assert.assertNotNull(_admin.getResourceIdealState(CLUSTER_NAME, workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      IdealState is = _admin.getResourceIdealState(CLUSTER_NAME, workflowName);\n      return (wfcfg == null && wfctx == null && is == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/integration/task/TestForceDeleteWorkflow.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":187,"status":"B"}],"commitId":"33aa50c13c785f71379e3c9e93af6742e0d18ca0","commitMessage":"@@@Add integration test for workflow ForceDelete\n\nThis commit adds integration tests for ForceDelete.\ncheck the functionality of ForceDelete.\nAdd comment to ForceDelete that discourages users from using ForceDelete.\nSeveral workflow states have been considered and checked for ForceDelete.","date":"2019-08-31 00:56:39","modifiedFileCount":"1","status":"B","submitter":"Ali Reza Zamani Zadeh Najari"},{"authorTime":"2020-09-15 05:40:00","codes":[{"authorDate":"2020-09-15 05:40:00","commitOrder":2,"curCode":"  public void testDeleteRunningWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, LONG_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    \r\n    _driver.pollForJobState(workflowName, TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"),\n        TaskState.IN_PROGRESS);\n\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      return (wfcfg == null && wfctx == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","date":"2020-09-15 05:40:00","endLine":169,"groupId":"10541","id":3,"instanceNumber":1,"isCurCommit":1,"methodName":"testDeleteRunningWorkflowForcefully","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/2a/c9f519b5b2cfbb8d685a48132f52db592f58c4.src","preCode":"  public void testDeleteRunningWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, LONG_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    \r\n    _driver.pollForJobState(workflowName, TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"),\n        TaskState.IN_PROGRESS);\n\n    \r\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n    Assert.assertNotNull(_admin.getResourceIdealState(CLUSTER_NAME, workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      IdealState is = _admin.getResourceIdealState(CLUSTER_NAME, workflowName);\n      return (wfcfg == null && wfctx == null && is == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/integration/task/TestForceDeleteWorkflow.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":133,"status":"M"},{"authorDate":"2020-09-15 05:40:00","commitOrder":2,"curCode":"  public void testDeleteStoppedWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, MEDIUM_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    _driver.stop(workflowName);\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.STOPPED);\n\n    \r\n    boolean areJobsStopped = TestHelper.verify(() -> {\n      WorkflowContext wCtx1 = _driver.getWorkflowContext(workflowName);\n      TaskState job0 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"));\n      TaskState job1 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB1\"));\n      TaskState job2 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB2\"));\n      return ((job0 == null || job0 == TaskState.STOPPED)\n          && (job1 == null || job1 == TaskState.STOPPED)\n          && (job2 == null || job2 == TaskState.STOPPED));\n    }, 60 * 1000);\n    Assert.assertTrue(areJobsStopped);\n\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      return (wfcfg == null && wfctx == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","date":"2020-09-15 05:40:00","endLine":221,"groupId":"10541","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"testDeleteStoppedWorkflowForcefully","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/2a/c9f519b5b2cfbb8d685a48132f52db592f58c4.src","preCode":"  public void testDeleteStoppedWorkflowForcefully() throws Exception {\n    \r\n    \r\n\n    \r\n    String controllerName = CONTROLLER_PREFIX + \"_0\";\n    _controller = new ClusterControllerManager(ZK_ADDR, CLUSTER_NAME, controllerName);\n    _controller.syncStart();\n\n    String workflowName = TestHelper.getTestMethodName();\n    Workflow.Builder builder = createCustomWorkflow(workflowName, MEDIUM_EXECUTION_TIME, \"0\");\n    _driver.start(builder.build());\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.IN_PROGRESS);\n\n    _driver.stop(workflowName);\n\n    \r\n    _driver.pollForWorkflowState(workflowName, TaskState.STOPPED);\n\n    \r\n    boolean areJobsStopped = TestHelper.verify(() -> {\n      WorkflowContext wCtx1 = _driver.getWorkflowContext(workflowName);\n      TaskState job0 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB0\"));\n      TaskState job1 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB1\"));\n      TaskState job2 = wCtx1.getJobState(TaskUtil.getNamespacedJobName(workflowName, \"JOB2\"));\n      return ((job0 == null || job0 == TaskState.STOPPED)\n          && (job1 == null || job1 == TaskState.STOPPED)\n          && (job2 == null || job2 == TaskState.STOPPED));\n    }, 60 * 1000);\n    Assert.assertTrue(areJobsStopped);\n\n    \r\n    \r\n    Assert.assertNotNull(_driver.getWorkflowConfig(workflowName));\n    Assert.assertNotNull(_driver.getWorkflowContext(workflowName));\n    Assert.assertNotNull(_admin.getResourceIdealState(CLUSTER_NAME, workflowName));\n\n    \r\n    _controller.syncStop();\n\n    _driver.delete(workflowName, true);\n\n    \r\n    \r\n    boolean isWorkflowDeleted = TestHelper.verify(() -> {\n      WorkflowConfig wfcfg = _driver.getWorkflowConfig(workflowName);\n      WorkflowContext wfctx = _driver.getWorkflowContext(workflowName);\n      IdealState is = _admin.getResourceIdealState(CLUSTER_NAME, workflowName);\n      return (wfcfg == null && wfctx == null && is == null);\n    }, 60 * 1000);\n    Assert.assertTrue(isWorkflowDeleted);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/integration/task/TestForceDeleteWorkflow.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":172,"status":"M"}],"commitId":"027481f2906cc9d2a5ee104f9e844d0ec8d06e3d","commitMessage":"@@@Task Framework IdealState Removal (#1326)\n\nThis commit removes IdealState usage from Task Framework. \nThe TaskDriver no longer creates IdealState when workflows/jobs are created. \nThe controller-side no longer reads/create IdealState to create resources for Task Framework.","date":"2020-09-15 05:40:00","modifiedFileCount":"16","status":"M","submitter":"Neal Sun"}]
