[{"authorTime":"2019-06-26 16:57:46","codes":[{"authorDate":"2019-06-26 16:57:46","commitOrder":1,"curCode":"    public void testNestedCreate() throws Exception {\n\n        multi(zk, Arrays.asList(\n                \n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a/1\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n\n                \n                Op.delete(\"/multi/a/1\", 0),\n                Op.delete(\"/multi/a\", 0),\n                Op.delete(\"/multi\", 0)\n                ));\n\n        \r\n        Assert.assertNull(zk.exists(\"/multi/a/1\", null));\n        Assert.assertNull(zk.exists(\"/multi/a\", null));\n        Assert.assertNull(zk.exists(\"/multi\", null));\n    }\n","date":"2019-06-26 16:57:46","endLine":522,"groupId":"2818","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testNestedCreate","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/04/1f0773807d307e7817b4dada361d6bb5844ab2.src","preCode":"    public void testNestedCreate() throws Exception {\n\n        multi(zk, Arrays.asList(\n                \n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a/1\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n\n                \n                Op.delete(\"/multi/a/1\", 0),\n                Op.delete(\"/multi/a\", 0),\n                Op.delete(\"/multi\", 0)\n                ));\n\n        \r\n        Assert.assertNull(zk.exists(\"/multi/a/1\", null));\n        Assert.assertNull(zk.exists(\"/multi/a\", null));\n        Assert.assertNull(zk.exists(\"/multi\", null));\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/MultiOperationTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":504,"status":"B"},{"authorDate":"2019-06-26 16:57:46","commitOrder":1,"curCode":"    public void testUpdateConflict() throws Exception {\n\n        Assert.assertNull(zk.exists(\"/multi\", null));\n\n        try {\n            multi(zk, Arrays.asList(\n                    Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                    Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                    Op.setData(\"/multi\", \"Y\".getBytes(), 0)\n                    ));\n            Assert.fail(\"Should have thrown a KeeperException for invalid version\");\n        } catch (KeeperException e) {\n            \r\n            LOG.error(\"STACKTRACE: \", e);\n        }\n\n        Assert.assertNull(zk.exists(\"/multi\", null));\n\n        \r\n        multi(zk, Arrays.asList(\n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                Op.setData(\"/multi\", \"Y\".getBytes(), 1)\n                ));\n\n        Assert.assertArrayEquals(zk.getData(\"/multi\", false, null), \"Y\".getBytes());\n    }\n","date":"2019-06-26 16:57:46","endLine":569,"groupId":"3704","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testUpdateConflict","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/04/1f0773807d307e7817b4dada361d6bb5844ab2.src","preCode":"    public void testUpdateConflict() throws Exception {\n\n        Assert.assertNull(zk.exists(\"/multi\", null));\n\n        try {\n            multi(zk, Arrays.asList(\n                    Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                    Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                    Op.setData(\"/multi\", \"Y\".getBytes(), 0)\n                    ));\n            Assert.fail(\"Should have thrown a KeeperException for invalid version\");\n        } catch (KeeperException e) {\n            \r\n            LOG.error(\"STACKTRACE: \", e);\n        }\n\n        Assert.assertNull(zk.exists(\"/multi\", null));\n\n        \r\n        multi(zk, Arrays.asList(\n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                Op.setData(\"/multi\", \"Y\".getBytes(), 1)\n                ));\n\n        Assert.assertArrayEquals(zk.getData(\"/multi\", false, null), \"Y\".getBytes());\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/MultiOperationTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":543,"status":"B"}],"commitId":"1b074d6a8a448e1d3d50383a7d6f2e21d5cf1dfc","commitMessage":"@@@ZOOKEEPER-3402: Add multiRead operation\n\nSo.  the possibility of the multi version of getChildren.  getData.  and a common multiRead interface was already mentioned and briefly discussed in the conversation thread of #922.\nThis patch introduces the concept of multiRead operation.\nNote: This is a 'work-in-progress'.  not every comment is added.  and test cases should be extended as well. Currently.  the aim is to decide whether this direction is something that the community would get behind or should fin.\nI've faced more design decision while implementing this (note: I wanted to keep the backward compatibility at all cost).  the more important ones were the following:\n1. Whether the new read operations should be part of Op or should we create new descendant classes of `Op` like `ReadOp` and `WriteOp`. In this case.  I believe it would be unnecessary to create new classes since it would create a lot of code duplication (despite the common ancestor) and the flow of the processing would not be as clean as in the initial state. However.  by simply adding an OpKind enum to the class enables us to ensure the type-safety behavior (read and write operations should not mix) and still preserve the clean processing flow.\n2. At which point of request processing should we capture the mixed (transaction and read operation) multi requests? It seems pretty clear to catch them client side and not create extra work for the server.\n3. Do we even need a `multiRead` operation or this whole improvement could be just part of multi? Well.  the main problem is the following: currently.  on server side (and in general.  everywhere in ZooKeeper) the fact that multi only contains transactions is a heavily used and built upon it. The whole `multi` processing flow should be rewritten from zero and also the server would get a significant extra work for that. So yeah.  it seems pretty clear to me that introducing the `multiRead` operation is beneficial.\n\nHope these thoughts make sense! Any observations.  questions are welcome!\n\nAuthor: szepet <szepet95@gmail.com>\nAuthor: Peter Szecsi <szepet95@gmail.com>\n\nReviewers: fangmin@apache.org.  andor@apache.org\n\nCloses #959 from szepet/ZOOKEEPER-3402 and squashes the following commits:\n\n2f128ef11 [szepet] rephrase exception\n660351cce [Peter Szecsi] Rename MultiTransactionRecord to MultiOperationRecord\n71a6d2e22 [Peter Szecsi] address some review comments\n3cec54850 [szepet] make sure not to expose the internal representation in GetDataResult\nd4c6764ee [szepet] ZOOKEEPER-3402: Add multiRead operation\n","date":"2019-06-26 16:57:46","modifiedFileCount":"11","status":"B","submitter":"szepet"},{"authorTime":"2019-08-17 23:13:15","codes":[{"authorDate":"2019-08-17 23:13:15","commitOrder":2,"curCode":"    public void testNestedCreate() throws Exception {\n\n        multi(zk, Arrays.asList(\n                \n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT), Op.create(\"/multi/a\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT), Op.create(\"/multi/a/1\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n\n                \n                Op.delete(\"/multi/a/1\", 0), Op.delete(\"/multi/a\", 0), Op.delete(\"/multi\", 0)));\n\n        \r\n        assertNull(zk.exists(\"/multi/a/1\", null));\n        assertNull(zk.exists(\"/multi/a\", null));\n        assertNull(zk.exists(\"/multi\", null));\n    }\n","date":"2019-08-17 23:13:15","endLine":486,"groupId":"2818","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testNestedCreate","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/2e/48600da00aac97ff91a16afb6f720b988581bb.src","preCode":"    public void testNestedCreate() throws Exception {\n\n        multi(zk, Arrays.asList(\n                \n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a/1\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n\n                \n                Op.delete(\"/multi/a/1\", 0),\n                Op.delete(\"/multi/a\", 0),\n                Op.delete(\"/multi\", 0)\n                ));\n\n        \r\n        Assert.assertNull(zk.exists(\"/multi/a/1\", null));\n        Assert.assertNull(zk.exists(\"/multi/a\", null));\n        Assert.assertNull(zk.exists(\"/multi\", null));\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/MultiOperationTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":473,"status":"M"},{"authorDate":"2019-08-17 23:13:15","commitOrder":2,"curCode":"    public void testUpdateConflict() throws Exception {\n\n        assertNull(zk.exists(\"/multi\", null));\n\n        try {\n            multi(zk, Arrays.asList(\n                    Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                    Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                    Op.setData(\"/multi\", \"Y\".getBytes(), 0)));\n            fail(\"Should have thrown a KeeperException for invalid version\");\n        } catch (KeeperException e) {\n            \r\n            LOG.error(\"STACKTRACE: \", e);\n        }\n\n        assertNull(zk.exists(\"/multi\", null));\n\n        \r\n        multi(zk, Arrays.asList(\n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                Op.setData(\"/multi\", \"Y\".getBytes(), 1)));\n\n        assertArrayEquals(zk.getData(\"/multi\", false, null), \"Y\".getBytes());\n    }\n","date":"2019-08-17 23:13:15","endLine":531,"groupId":"3793","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testUpdateConflict","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/2e/48600da00aac97ff91a16afb6f720b988581bb.src","preCode":"    public void testUpdateConflict() throws Exception {\n\n        Assert.assertNull(zk.exists(\"/multi\", null));\n\n        try {\n            multi(zk, Arrays.asList(\n                    Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                    Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                    Op.setData(\"/multi\", \"Y\".getBytes(), 0)\n                    ));\n            Assert.fail(\"Should have thrown a KeeperException for invalid version\");\n        } catch (KeeperException e) {\n            \r\n            LOG.error(\"STACKTRACE: \", e);\n        }\n\n        Assert.assertNull(zk.exists(\"/multi\", null));\n\n        \r\n        multi(zk, Arrays.asList(\n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                Op.setData(\"/multi\", \"Y\".getBytes(), 1)\n                ));\n\n        Assert.assertArrayEquals(zk.getData(\"/multi\", false, null), \"Y\".getBytes());\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/MultiOperationTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":507,"status":"M"}],"commitId":"fe940cdd8fb23ba09684cefb73233d570f4a20fa","commitMessage":"@@@ZOOKEEPER-3475: Enable Checkstyle configuration on zookeeper-server\n\n- [x] org/apache/zookeeper\n- [x] org/apache/zookeeper/admin\n- [x] org/apache/zookeeper/cli\n- [x] org/apache/zookeeper/client\n- [x] org/apache/zookeeper/common\n- [x] org/apache/zookeeper/jmx\n- [x] org/apache/zookeeper/metrics\n- [x] org/apache/zookeeper/metrics/impl\n- [x] org/apache/zookeeper/server\n- [x] org/apache/zookeeper/server/admin\n- [x] org/apache/zookeeper/server/auth\n- [x] org/apache/zookeeper/server/command\n- [x] org/apache/zookeeper/server/metric\n- [x] org/apache/zookeeper/server/persistence\n- [x] org/apache/zookeeper/server/quorum\n- [x] org/apache/zookeeper/server/quorum/auth\n- [x] org/apache/zookeeper/server/quorum/flexible\n- [x] org/apache/zookeeper/server/util\n- [x] org/apache/zookeeper/server/watch\n- [x] org/apache/zookeeper/test\n- [x] org/apache/zookeeper/util\n- [x] org/apache/zookeeper/version/util\n\nAuthor: tison <wander4096@gmail.com>\n\nReviewers: Brian Nixon <nixon@fb.com>.  Enrico Olivelli <eolivelli@gmail.com>.  Michael Han <hanm@apache.org>\n\nCloses #1049 from TisonKun/ZOOKEEPER-3475\n","date":"2019-08-17 23:13:15","modifiedFileCount":"631","status":"M","submitter":"tison"},{"authorTime":"2020-08-04 21:01:52","codes":[{"authorDate":"2020-08-04 21:01:52","commitOrder":3,"curCode":"    public void testNestedCreate(boolean useAsync) throws Exception {\n\n        multi(zk, Arrays.asList(\n                \n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.create(\"/multi/a/1\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                \n                Op.delete(\"/multi/a/1\", 0), Op.delete(\"/multi/a\", 0), Op.delete(\"/multi\", 0)), useAsync);\n\n        \r\n        assertNull(zk.exists(\"/multi/a/1\", null));\n        assertNull(zk.exists(\"/multi/a\", null));\n        assertNull(zk.exists(\"/multi\", null));\n    }\n","date":"2020-08-04 21:01:52","endLine":495,"groupId":"10628","id":5,"instanceNumber":1,"isCurCommit":1,"methodName":"testNestedCreate","params":"(booleanuseAsync)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/4f/f593222fe15df710f0d422f0f59b71e3793137.src","preCode":"    public void testNestedCreate() throws Exception {\n\n        multi(zk, Arrays.asList(\n                \n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT), Op.create(\"/multi/a\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT), Op.create(\"/multi/a/1\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n\n                \n                Op.delete(\"/multi/a/1\", 0), Op.delete(\"/multi/a\", 0), Op.delete(\"/multi\", 0)));\n\n        \r\n        assertNull(zk.exists(\"/multi/a/1\", null));\n        assertNull(zk.exists(\"/multi/a\", null));\n        assertNull(zk.exists(\"/multi\", null));\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/MultiOperationTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":481,"status":"M"},{"authorDate":"2020-08-04 21:01:52","commitOrder":3,"curCode":"    public void testUpdateConflict(boolean useAsync) throws Exception {\n\n        assertNull(zk.exists(\"/multi\", null));\n\n        try {\n            multi(zk, Arrays.asList(\n                    Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                    Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                    Op.setData(\"/multi\", \"Y\".getBytes(), 0)),\n                    useAsync);\n            fail(\"Should have thrown a KeeperException for invalid version\");\n        } catch (KeeperException e) {\n            \r\n            LOG.error(\"STACKTRACE: \", e);\n        }\n\n        assertNull(zk.exists(\"/multi\", null));\n\n        \r\n        multi(zk, Arrays.asList(\n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                Op.setData(\"/multi\", \"Y\".getBytes(), 1)),\n                useAsync);\n\n        assertArrayEquals(zk.getData(\"/multi\", false, null), \"Y\".getBytes());\n    }\n","date":"2020-08-04 21:01:52","endLine":544,"groupId":"10628","id":6,"instanceNumber":2,"isCurCommit":1,"methodName":"testUpdateConflict","params":"(booleanuseAsync)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/4f/f593222fe15df710f0d422f0f59b71e3793137.src","preCode":"    public void testUpdateConflict() throws Exception {\n\n        assertNull(zk.exists(\"/multi\", null));\n\n        try {\n            multi(zk, Arrays.asList(\n                    Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                    Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                    Op.setData(\"/multi\", \"Y\".getBytes(), 0)));\n            fail(\"Should have thrown a KeeperException for invalid version\");\n        } catch (KeeperException e) {\n            \r\n            LOG.error(\"STACKTRACE: \", e);\n        }\n\n        assertNull(zk.exists(\"/multi\", null));\n\n        \r\n        multi(zk, Arrays.asList(\n                Op.create(\"/multi\", new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),\n                Op.setData(\"/multi\", \"X\".getBytes(), 0),\n                Op.setData(\"/multi\", \"Y\".getBytes(), 1)));\n\n        assertArrayEquals(zk.getData(\"/multi\", false, null), \"Y\".getBytes());\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/MultiOperationTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":518,"status":"M"}],"commitId":"c42c8c94085ed1d94a22158fbdfe2945118a82bc","commitMessage":"@@@ZOOKEEPER-3872: Upgrade jUnit in ZooKeeper-server\n\nSub-task of ZOOKEEPER-3732.  updating jUnit to 5.6.2 in zookeeper-server sub-component.\n\nChange-Id: I1fc2a7f860eae0f1d285cb278f6eca7a3b947695\n\nAuthor: Tamas Penzes <tamaas@cloudera.com>\n\nReviewers: Mate Szalay-Beko <symat@apache.org>.  Norbert Kalmar <nkalmar@apache.org>\n\nCloses #1417 from tamaashu/ZOOKEEPER-3872\n","date":"2020-08-04 21:01:52","modifiedFileCount":"303","status":"M","submitter":"Tamas Penzes"}]
