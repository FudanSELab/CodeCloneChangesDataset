[{"authorTime":"2019-06-20 04:57:37","codes":[{"authorDate":"2019-06-20 04:57:37","commitOrder":1,"curCode":"  public void testGroupByExpressionAuto()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"concat(tags, 'foo')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<Row> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t1foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t2foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t3foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t4foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t5foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t6foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t7foo\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-auto\");\n  }\n","date":"2019-06-20 04:57:37","endLine":619,"groupId":"12751","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByExpressionAuto","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/f0/282c6ed7b058124da7d55fccb04d68dd2c7b19.src","preCode":"  public void testGroupByExpressionAuto()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"concat(tags, 'foo')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<Row> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t1foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t2foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t3foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t4foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t5foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t6foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t7foo\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-auto\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/MultiValuedDimensionTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":575,"status":"B"},{"authorDate":"2019-06-20 04:57:37","commitOrder":1,"curCode":"  public void testGroupByExpressionFoldArrayToStringWithConcats()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"fold((tag, acc) -> concat(concat(acc, case_searched(acc == '', '', ', '), concat('foo', tag)))), tags, '')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<Row> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot1, foot2, foot3\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot3, foot4, foot5\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot5, foot6, foot7\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-arrayfn-auto\");\n  }\n","date":"2019-06-20 04:57:37","endLine":798,"groupId":"12751","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByExpressionFoldArrayToStringWithConcats","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/f0/282c6ed7b058124da7d55fccb04d68dd2c7b19.src","preCode":"  public void testGroupByExpressionFoldArrayToStringWithConcats()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"fold((tag, acc) -> concat(concat(acc, case_searched(acc == '', '', ', '), concat('foo', tag)))), tags, '')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<Row> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot1, foot2, foot3\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot3, foot4, foot5\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot5, foot6, foot7\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-arrayfn-auto\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/MultiValuedDimensionTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":758,"status":"B"}],"commitId":"494b8ebe56308fe69c2a758f80f1ae56bf17d54d","commitMessage":"@@@multi-value string column support for expressions (#7588)\n\n* array support for expression language for multi-value string columns\n\n* fix tests?\n\n* fixes\n\n* more tests\n\n* fixes\n\n* cleanup\n\n* more better.  more test\n\n* ignore inspection\n\n* license\n\n* license fix\n\n* inspection\n\n* remove dumb import\n\n* more better\n\n* some comments\n\n* add expr rewrite for arrayfn args for more magic.  tests\n\n* test stuff\n\n* more tests\n\n* fix test\n\n* fix test\n\n* castfunc can deal with arrays\n\n* needs more empty array\n\n* more tests.  make cast to long array more forgiving\n\n* refactor\n\n* simplify ExprMacro Expr implementations with base classes in core\n\n* oops\n\n* more test\n\n* use Shuttle for Parser.flatten.  javadoc.  cleanup\n\n* fixes and more tests\n\n* unused import\n\n* fixes\n\n* javadocs.  cleanup.  refactors\n\n* fix imports\n\n* more javadoc\n\n* more javadoc\n\n* more\n\n* more javadocs.  nonnullbydefault.  minor refactor\n\n* markdown fix\n\n* adjustments\n\n* more doc\n\n* move initial filter out\n\n* docs\n\n* map empty arg lambda.  apply function argument validation\n\n* check function args at parse time instead of eval time\n\n* more immutable\n\n* more more immutable\n\n* clarify grammar\n\n* fix docs\n\n* empty array is string test.  we need a way to make arrays better maybe in the future.  or define empty arrays as other types..\n","date":"2019-06-20 04:57:37","modifiedFileCount":"43","status":"B","submitter":"Clint Wylie"},{"authorTime":"2019-08-01 07:15:12","codes":[{"authorDate":"2019-08-01 07:15:12","commitOrder":2,"curCode":"  public void testGroupByExpressionAuto()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"concat(tags, 'foo')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<ResultRow> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t1foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t2foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t3foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t4foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t5foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t6foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t7foo\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-auto\");\n  }\n","date":"2019-08-01 07:15:12","endLine":713,"groupId":"13149","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByExpressionAuto","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/56/892584c3cf1ac7d62d599102b0515b9107bf6d.src","preCode":"  public void testGroupByExpressionAuto()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"concat(tags, 'foo')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<Row> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t1foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t2foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t3foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t4foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t5foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t6foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"t7foo\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-auto\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/MultiValuedDimensionTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":669,"status":"M"},{"authorDate":"2019-08-01 07:15:12","commitOrder":2,"curCode":"  public void testGroupByExpressionFoldArrayToStringWithConcats()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"fold((tag, acc) -> concat(concat(acc, case_searched(acc == '', '', ', '), concat('foo', tag)))), tags, '')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<ResultRow> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot1, foot2, foot3\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot3, foot4, foot5\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot5, foot6, foot7\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-arrayfn-auto\");\n  }\n","date":"2019-08-01 07:15:12","endLine":934,"groupId":"13149","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByExpressionFoldArrayToStringWithConcats","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/56/892584c3cf1ac7d62d599102b0515b9107bf6d.src","preCode":"  public void testGroupByExpressionFoldArrayToStringWithConcats()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"fold((tag, acc) -> concat(concat(acc, case_searched(acc == '', '', ', '), concat('foo', tag)))), tags, '')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<Row> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot1, foot2, foot3\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot3, foot4, foot5\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\"1970-01-01T00:00:00.000Z\", \"tt\", \"foot5, foot6, foot7\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-arrayfn-auto\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/MultiValuedDimensionTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":894,"status":"M"}],"commitId":"77297f4e6f2e9d617c96cd46852bb5a772961e85","commitMessage":"@@@GroupBy array-based result rows. (#8196)\n\n* GroupBy array-based result rows.\n\nFixes #8118; see that proposal for details.\n\nOther than the GroupBy changes.  the main other \"interesting\" classes are:\n\n- ResultRow: The array-based result type.\n- BaseQuery: T is no longer required to be Comparable.\n- QueryToolChest: Adds \"decorateObjectMapper\" to enable query-aware serialization\n  and deserialization of result rows (necessary due to their positional nature).\n- QueryResource: Uses the new decoration functionality.\n- DirectDruidClient: Also uses the new decoration functionality.\n- QueryMaker (in Druid SQL): Modifications to read ResultRows.\n\nThese classes weren't changed.  but got some new javadocs:\n\n- BySegmentQueryRunner\n- FinalizeResultsQueryRunner\n- Query\n\n* Adjustments for TC stuff.\n","date":"2019-08-01 07:15:12","modifiedFileCount":"111","status":"M","submitter":"Gian Merlino"},{"authorTime":"2019-08-01 07:15:12","codes":[{"authorDate":"2019-08-03 04:21:25","commitOrder":3,"curCode":"  public void testGroupByExpressionAuto()\n  {\n    \r\n    \r\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"concat(tags, 'foo')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<ResultRow> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t1foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t2foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t3foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t4foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t5foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t6foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t7foo\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-auto\");\n  }\n","date":"2019-08-03 04:21:25","endLine":711,"groupId":"106285","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByExpressionAuto","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/7e/c9ed913073950c8a6a3dc0afa8258bb0778b19.src","preCode":"  public void testGroupByExpressionAuto()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"concat(tags, 'foo')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<ResultRow> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t1foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t2foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t3foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t4foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t5foo\", \"count\", 4L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t6foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"t7foo\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-auto\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/MultiValuedDimensionTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":669,"status":"M"},{"authorDate":"2019-08-01 07:15:12","commitOrder":3,"curCode":"  public void testGroupByExpressionFoldArrayToStringWithConcats()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"fold((tag, acc) -> concat(concat(acc, case_searched(acc == '', '', ', '), concat('foo', tag)))), tags, '')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<ResultRow> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot1, foot2, foot3\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot3, foot4, foot5\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot5, foot6, foot7\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-arrayfn-auto\");\n  }\n","date":"2019-08-01 07:15:12","endLine":934,"groupId":"106285","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByExpressionFoldArrayToStringWithConcats","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/56/892584c3cf1ac7d62d599102b0515b9107bf6d.src","preCode":"  public void testGroupByExpressionFoldArrayToStringWithConcats()\n  {\n    if (config.getDefaultStrategy().equals(GroupByStrategySelector.STRATEGY_V1)) {\n      expectedException.expect(RuntimeException.class);\n      expectedException.expectMessage(\"GroupBy v1 does not support dimension selectors with unknown cardinality.\");\n    }\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(\"xx\")\n        .setQuerySegmentSpec(new LegacySegmentSpec(\"1970/3000\"))\n        .setGranularity(Granularities.ALL)\n        .setDimensions(new DefaultDimensionSpec(\"tt\", \"tt\"))\n        .setVirtualColumns(\n            new ExpressionVirtualColumn(\n                \"tt\",\n                \"fold((tag, acc) -> concat(concat(acc, case_searched(acc == '', '', ', '), concat('foo', tag)))), tags, '')\",\n                ValueType.STRING,\n                TestExprMacroTable.INSTANCE\n            )\n        )\n        .setAggregatorSpecs(new CountAggregatorFactory(\"count\"))\n        .setContext(context)\n        .build();\n\n    Sequence<ResultRow> result = helper.runQueryOnSegmentsObjs(\n        ImmutableList.of(\n            new QueryableIndexSegment(queryableIndex, SegmentId.dummy(\"sid1\")),\n            new IncrementalIndexSegment(incrementalIndex, SegmentId.dummy(\"sid2\"))\n        ),\n        query\n    );\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foo\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot1, foot2, foot3\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot3, foot4, foot5\", \"count\", 2L),\n        GroupByQueryRunnerTestHelper.createExpectedRow(query, \"1970\", \"tt\", \"foot5, foot6, foot7\", \"count\", 2L)\n    );\n\n    TestHelper.assertExpectedObjects(expectedResults, result.toList(), \"expr-arrayfn-auto\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/MultiValuedDimensionTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":894,"status":"N"}],"commitId":"e7c6deac768d66c12b71daecae12ecb5a7db2380","commitMessage":"@@@optimize single input column multi-value expressions (#8047)\n\n* optimize single input column multi-value expressions\n\n* javadocs\n\n* merge fixup\n\n* vectorization fixup\n\n* more fixes\n\n* more docs\n\n* more links\n\n* empty\n\n* javadocs are hard\n\n* suppress javadoc refs issue\n\n* fix it\n","date":"2019-08-03 04:21:25","modifiedFileCount":"24","status":"M","submitter":"Clint Wylie"}]
