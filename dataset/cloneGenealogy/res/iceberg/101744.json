[{"authorTime":"2021-01-14 06:23:01","codes":[{"authorDate":"2020-12-29 18:02:09","commitOrder":2,"curCode":"  public void testCommitUpdatedSpec() {\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    PartitionSpec evolvedSpec = PartitionSpec.builderFor(table.schema())\n        .withSpecId(1)\n        .bucket(\"data\", 16)\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build();\n    Assert.assertEquals(\"Should append a partition field to the spec\", evolvedSpec, table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n\n    table.updateSpec()\n        .removeField(\"id_bucket_8\")\n        .removeField(\"data_bucket\")\n        .addField(truncate(\"data\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should soft delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .alwaysNull(\"id\", \"id_bucket_8\")\n        .truncate(\"data\", 8, \"data_trunc_8\")\n        .build(), table.spec());\n\n    V2Assert.assertEquals(\"Should hard delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(2, 1002, \"data_trunc_8\", \"truncate[8]\")\n        .build(), table.spec());\n\n    Assert.assertEquals(1002, table.spec().lastAssignedFieldId());\n  }\n","date":"2020-12-29 18:02:09","endLine":87,"groupId":"2682","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testCommitUpdatedSpec","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/15/30701f1006ab46abec3ea5d6c752adc39b5259.src","preCode":"  public void testCommitUpdatedSpec() {\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    PartitionSpec evolvedSpec = PartitionSpec.builderFor(table.schema())\n        .withSpecId(1)\n        .bucket(\"data\", 16)\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build();\n    Assert.assertEquals(\"Should append a partition field to the spec\", evolvedSpec, table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n\n    table.updateSpec()\n        .removeField(\"id_bucket_8\")\n        .removeField(\"data_bucket\")\n        .addField(truncate(\"data\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should soft delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .alwaysNull(\"id\", \"id_bucket_8\")\n        .truncate(\"data\", 8, \"data_trunc_8\")\n        .build(), table.spec());\n\n    V2Assert.assertEquals(\"Should hard delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(2, 1002, \"data_trunc_8\", \"truncate[8]\")\n        .build(), table.spec());\n\n    Assert.assertEquals(1002, table.spec().lastAssignedFieldId());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestTableUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":55,"status":"NB"},{"authorDate":"2021-01-14 06:23:01","commitOrder":2,"curCode":"  public void testAddAfterLastFieldRemoved() {\n    table.updateSpec()\n        .removeField(\"data_bucket\")\n        .commit();\n\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build(), table.spec());\n    V2Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(1, 1001, \"id_bucket_8\", \"bucket[8]\")\n        .build(), table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n  }\n","date":"2021-01-14 06:23:01","endLine":220,"groupId":"2688","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testAddAfterLastFieldRemoved","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/76/f9fa0b28fc4aa97ce3e26d94f71215dc4ca877.src","preCode":"  public void testAddAfterLastFieldRemoved() {\n    table.updateSpec()\n        .removeField(\"data_bucket\")\n        .commit();\n\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build(), table.spec());\n    V2Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(1, 1001, \"id_bucket_8\", \"bucket[8]\")\n        .build(), table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestTableUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":201,"status":"B"}],"commitId":"bfe1bfc00a3345134074100fa468312ef99a9f11","commitMessage":"@@@Core: Fix partition field id assignment for v2 (#2083)\n\n","date":"2021-01-14 06:23:01","modifiedFileCount":"2","status":"M","submitter":"jun-he"},{"authorTime":"2021-01-31 05:48:52","codes":[{"authorDate":"2020-12-29 18:02:09","commitOrder":3,"curCode":"  public void testCommitUpdatedSpec() {\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    PartitionSpec evolvedSpec = PartitionSpec.builderFor(table.schema())\n        .withSpecId(1)\n        .bucket(\"data\", 16)\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build();\n    Assert.assertEquals(\"Should append a partition field to the spec\", evolvedSpec, table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n\n    table.updateSpec()\n        .removeField(\"id_bucket_8\")\n        .removeField(\"data_bucket\")\n        .addField(truncate(\"data\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should soft delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .alwaysNull(\"id\", \"id_bucket_8\")\n        .truncate(\"data\", 8, \"data_trunc_8\")\n        .build(), table.spec());\n\n    V2Assert.assertEquals(\"Should hard delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(2, 1002, \"data_trunc_8\", \"truncate[8]\")\n        .build(), table.spec());\n\n    Assert.assertEquals(1002, table.spec().lastAssignedFieldId());\n  }\n","date":"2020-12-29 18:02:09","endLine":87,"groupId":"101744","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testCommitUpdatedSpec","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/15/30701f1006ab46abec3ea5d6c752adc39b5259.src","preCode":"  public void testCommitUpdatedSpec() {\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    PartitionSpec evolvedSpec = PartitionSpec.builderFor(table.schema())\n        .withSpecId(1)\n        .bucket(\"data\", 16)\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build();\n    Assert.assertEquals(\"Should append a partition field to the spec\", evolvedSpec, table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n\n    table.updateSpec()\n        .removeField(\"id_bucket_8\")\n        .removeField(\"data_bucket\")\n        .addField(truncate(\"data\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should soft delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .alwaysNull(\"id\", \"id_bucket_8\")\n        .truncate(\"data\", 8, \"data_trunc_8\")\n        .build(), table.spec());\n\n    V2Assert.assertEquals(\"Should hard delete id and data buckets\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(2, 1002, \"data_trunc_8\", \"truncate[8]\")\n        .build(), table.spec());\n\n    Assert.assertEquals(1002, table.spec().lastAssignedFieldId());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestTableUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":55,"status":"N"},{"authorDate":"2021-01-31 05:48:52","commitOrder":3,"curCode":"  public void testAddAfterLastFieldRemoved() {\n    table.updateSpec()\n        .removeField(\"data_bucket\")\n        .commit();\n\n    V1Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(1)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .build(), table.spec());\n    V1Assert.assertEquals(\"Should match the last assigned field id\",\n        1000, table.spec().lastAssignedFieldId());\n    V2Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(1)\n        .build(), table.spec());\n    V2Assert.assertEquals(\"Should match the last assigned field id\",\n        999, table.spec().lastAssignedFieldId());\n    Assert.assertEquals(1000, table.ops().current().lastAssignedPartitionId());\n\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build(), table.spec());\n    V2Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(1, 1001, \"id_bucket_8\", \"bucket[8]\")\n        .build(), table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n    Assert.assertEquals(1001, table.ops().current().lastAssignedPartitionId());\n  }\n","date":"2021-01-31 05:48:52","endLine":234,"groupId":"101744","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"testAddAfterLastFieldRemoved","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/1e/5bd41af0a0de62e2ca63ef3da1df20fd827372.src","preCode":"  public void testAddAfterLastFieldRemoved() {\n    table.updateSpec()\n        .removeField(\"data_bucket\")\n        .commit();\n\n    table.updateSpec()\n        .addField(bucket(\"id\", 8))\n        .commit();\n\n    V1Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .alwaysNull(\"data\", \"data_bucket\")\n        .bucket(\"id\", 8, \"id_bucket_8\")\n        .build(), table.spec());\n    V2Assert.assertEquals(\"Should add a new id bucket\", PartitionSpec.builderFor(table.schema())\n        .withSpecId(2)\n        .add(1, 1001, \"id_bucket_8\", \"bucket[8]\")\n        .build(), table.spec());\n    Assert.assertEquals(1001, table.spec().lastAssignedFieldId());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestTableUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":201,"status":"M"}],"commitId":"b3e01b74fb8909d0c5aa3f9a1b9468471e03c13c","commitMessage":"@@@Core: Add lastAssignedPartitionId to TableMetadata (#2089)\n\n","date":"2021-01-31 05:48:52","modifiedFileCount":"5","status":"M","submitter":"jun-he"}]
