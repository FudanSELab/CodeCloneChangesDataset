[{"authorTime":"2020-03-12 23:59:46","codes":[{"authorDate":"2020-03-12 23:59:46","commitOrder":1,"curCode":"    private Ternary<Boolean, Boolean, String> performPostMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced, Map<Long, String> hostsToAvoidMaintenance, List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PostMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Post-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, msg);\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","date":"2020-03-12 23:59:46","endLine":352,"groupId":"3430","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"performPostMaintenanceStageOnHost","params":"(Hosthost@inttimeout@Stringpayload@Booleanforced@Map<Long@String>hostsToAvoidMaintenance@List<HostSkipped>hostsSkipped)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/62/bb30e13237d5c7878528b11c8e1393926d5aa3.src","preCode":"    private Ternary<Boolean, Boolean, String> performPostMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced, Map<Long, String> hostsToAvoidMaintenance, List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PostMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Post-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, msg);\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","realPath":"server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":341,"status":"B"},{"authorDate":"2020-03-12 23:59:46","commitOrder":1,"curCode":"    private Ternary<Boolean, Boolean, String> performPreMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced,\n                                                                               Map<Long, String> hostsToAvoidMaintenance,\n                                                                               List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PreMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Pre-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, result.second());\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        if (result.third() && !hostsToAvoidMaintenance.containsKey(host.getId())) {\n            s_logger.debug(\"Host \" + host.getId() + \" added to the avoid maintenance set\");\n            hostsToAvoidMaintenance.put(host.getId(), \"Pre-maintenance stage set to avoid maintenance\");\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","date":"2020-03-12 23:59:46","endLine":471,"groupId":"3434","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"performPreMaintenanceStageOnHost","params":"(Hosthost@inttimeout@Stringpayload@Booleanforced@Map<Long@String>hostsToAvoidMaintenance@List<HostSkipped>hostsSkipped)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/62/bb30e13237d5c7878528b11c8e1393926d5aa3.src","preCode":"    private Ternary<Boolean, Boolean, String> performPreMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced,\n                                                                               Map<Long, String> hostsToAvoidMaintenance,\n                                                                               List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PreMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Pre-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, result.second());\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        if (result.third() && !hostsToAvoidMaintenance.containsKey(host.getId())) {\n            s_logger.debug(\"Host \" + host.getId() + \" added to the avoid maintenance set\");\n            hostsToAvoidMaintenance.put(host.getId(), \"Pre-maintenance stage set to avoid maintenance\");\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","realPath":"server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":454,"status":"B"}],"commitId":"efe00aa7e037fb56e00e52c1a3169defbe3fe0d6","commitMessage":"@@@[KVM] Rolling maintenance (#3610)\n\n","date":"2020-03-12 23:59:46","modifiedFileCount":"18","status":"B","submitter":"Nicolas Vazquez"},{"authorTime":"2021-07-14 04:35:59","codes":[{"authorDate":"2020-03-12 23:59:46","commitOrder":2,"curCode":"    private Ternary<Boolean, Boolean, String> performPostMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced, Map<Long, String> hostsToAvoidMaintenance, List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PostMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Post-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, msg);\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","date":"2020-03-12 23:59:46","endLine":352,"groupId":"101597","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"performPostMaintenanceStageOnHost","params":"(Hosthost@inttimeout@Stringpayload@Booleanforced@Map<Long@String>hostsToAvoidMaintenance@List<HostSkipped>hostsSkipped)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/62/bb30e13237d5c7878528b11c8e1393926d5aa3.src","preCode":"    private Ternary<Boolean, Boolean, String> performPostMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced, Map<Long, String> hostsToAvoidMaintenance, List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PostMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Post-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, msg);\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","realPath":"server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":341,"status":"N"},{"authorDate":"2021-07-14 04:35:59","commitOrder":2,"curCode":"    private Ternary<Boolean, Boolean, String> performPreMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced,\n                                                                               Map<Long, String> hostsToAvoidMaintenance,\n                                                                               List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PreMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Pre-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, result.second());\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        if (result.third() && !hostsToAvoidMaintenance.containsKey(host.getId())) {\n            logHostAddedToAvoidMaintenanceSet(host);\n            hostsToAvoidMaintenance.put(host.getId(), \"Pre-maintenance stage set to avoid maintenance\");\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","date":"2021-07-14 04:35:59","endLine":475,"groupId":"101597","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"performPreMaintenanceStageOnHost","params":"(Hosthost@inttimeout@Stringpayload@Booleanforced@Map<Long@String>hostsToAvoidMaintenance@List<HostSkipped>hostsSkipped)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/80/a243156aa0ae84e0f3f31d76e97e4a7c939c8c.src","preCode":"    private Ternary<Boolean, Boolean, String> performPreMaintenanceStageOnHost(Host host, int timeout, String payload, Boolean forced,\n                                                                               Map<Long, String> hostsToAvoidMaintenance,\n                                                                               List<HostSkipped> hostsSkipped) throws InterruptedException {\n        Ternary<Boolean, String, Boolean> result = performStageOnHost(host, Stage.PreMaintenance, timeout, payload, forced);\n        if (!result.first()) {\n            if (forced) {\n                String msg = \"Pre-maintenance script failed: \" + result.second();\n                hostsSkipped.add(new HostSkipped(host, msg));\n                return new Ternary<>(true, true, result.second());\n            }\n            return new Ternary<>(true, false, result.second());\n        }\n        if (result.third() && !hostsToAvoidMaintenance.containsKey(host.getId())) {\n            s_logger.debug(\"Host \" + host.getId() + \" added to the avoid maintenance set\");\n            hostsToAvoidMaintenance.put(host.getId(), \"Pre-maintenance stage set to avoid maintenance\");\n        }\n        return new Ternary<>(false, false, result.second());\n    }\n","realPath":"server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":458,"status":"M"}],"commitId":"ca78f5b38687bee264d9df2212e8ae4d0cac9a4c","commitMessage":"@@@Enhance log messages with host name (#4575)\n\n* Enhance log messages with hostName\n\n* Use host.toString() on most of host logs.\n\n* Remove redundant \"Host\" in logs and enhance logs\n\n* duplicated \"for\"\n\n* Adopt String.format.  and enhance code\n\n* Address reviews enhancing log messages\n\nUpdate server/src/main/java/com/cloud/resource/ResourceManagerImpl.java\n    -- server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\n    -- server/src/main/java/com/cloud/resource/RollingMaintenanceManagerImpl.java\n\nCo-authored-by: Daniel Augusto Veronezi Salvador <38945620+GutoVeronezi@users.noreply.github.com>\n\n* Fix String.format issue and change log message from debug to warn\n\n* Fix checkstyle issue\n\n* Fix string.format log\n\n* Address review: enhance logs\n\n* Enhance log of hosts in maintenance avoid list\n\n* Remove \"VM\" on logs as vm.toString() already appends VM-<details>\n\n* Add more details of the VM when postStateTransitionEvent\n\n* Address reviewer and enhance VMInstanceVO.toString()\n\nCo-authored-by: Daniel Augusto Veronezi Salvador <38945620+GutoVeronezi@users.noreply.github.com>","date":"2021-07-14 04:35:59","modifiedFileCount":"11","status":"M","submitter":"Gabriel Beims Br?scher"}]
